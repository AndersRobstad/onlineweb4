{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load compress %}
{% load formset_tags %}

{% block title %}
Generalforsamling logg inn- Online
{% endblock %}

{% block styles %}
    {{ block.super }}
    {% compress css %}
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}less/jquery-ui/jquery.ui.datepicker.min.css" />
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}less/jquery-ui/jquery.ui.theme.min.css" />
        <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}less/jquery-ui/jquery.ui.core.min.css" />
    {% endcompress %}
{% endblock %}

{% block content %}
<section id="generalforsamling">
    <div class="container">
        <div class="row">
            <div class="page-header">
                <a href="{% url 'genfors_admin_logout' %}"class="btn btn-warning pull-right" id="gf_admin_logout">Logg ut</a>
                <h2>Generalforsamling adminpanel</h2>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
            {% if meeting %}
                <h1>{{ meeting.title }}</h1>
                {% if question %}
                {{ question.description }}
                {% else %}
                <h3>Nytt spørsmål</h3>
                <div class="col-md-6">
                    <form method="post">
                        {% csrf_token %}
                        {{ form|crispy }}
                        <div id="formset" data-formset-prefix="{{ formset.prefix }}">
                            {{ formset.management_form }}
                            <div data-formset-body>
                                {% for form in formset %}
                                    <div data-formset-form>
                                        {{ form.description|as_crispy_field }}
                                        <div class="hidden">{{ form.DELETE }}</div>
                                        <button class="btn" data-formset-delete-button>X</button>
                                    </div>
                                {% endfor %}
                            </div>
                            <script type="form-template" data-formset-empty-form>
                                {% escapescript %}
                                    <div data-formset-form>
                                        {{ formset.empty_form.description|as_crispy_field }}
                                        <div class="hidden">{{ formset.empty_form.DELETE }}</div>
                                        <button class="btn" type="button" data-formset-delete-button>X</button>
                                    </div>
                                {% endescapescript %}
                            </script>
                            <button class="btn" data-formset-add>Legg til nytt valg</button>

                        </div>
                        <button class="btn btn-success" type="submit">Legg til spørsmål</button>
                    </form>
                </div>
                {% endif %}
            {% else %}
                <form method="post">
                    {% csrf_token %}
                    {{ form|crispy }}
                    <button class="btn btn-success" type="submit">Opprett nytt møte</button>
                </form>
            {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script src="{{ STATIC_URL }}js/jquery.formset.js"></script>
    <script type="text/javascript">
        $(function () {
            $('#id_start_date').datepicker({dateFormat: "dd.mm.yy"});
            $("#formset").formset({animateForms: true});
            $("#formset").hide();
            // Hide multiple choice values based on question type
            $("#id_question_type").change(function() {
                // Multiple choice selected
                if($(this).val() == 1) {
                    $("#formset").show();
                }
                else {
                    $("#formset").hide();
                }
            });
        });
    </script>
{% endblock %}
