{% extends "base.html" %}
{% block title %}
Generalforsamling - Online
{% endblock %}

{% block content %}
<section id="generalforsamling">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="page-header">
                    <h2>{% if meeting %}{{ meeting.title }}{% else %}GENERALFORSAMLING{% endif %}</h2>
                </div>
            </div>
        </div>
        <div class="row">
            {% if meeting %}
            <div class="col-md-12">
                {% with meeting.get_active_question as q %}
                <div class="row">
                    <div class="col-xs-12 col-sm-7 col-md-8">
                        <h3>Aktiv sak</h3>
                        <div class="well">{% if q %}{{ q.description }}{% else %}Ingen aktiv sak.{% endif %}</div>
                        {% if not already_voted %}
                            {% if q.question_type == 0 %}
                                <button class="btn btn-success" id="boolean_yes">JA</button>
                                <button class="btn btn-danger" id="boolean_no">NEI</button>
                                <button class="btn btn-primary" id="boolean_blank">BLANKT</button>
                            {% else %}
                                <p>Velg en av alternativene:</p>
                                <form action="/genfors/vote" id="vote" method="post">
                                    <fieldset>
                                        <input type="radio" id="0" name="choice" value="0" checked> Blankt</input><br />
                                        {% for alt in active_question.alternatives %}
                                            <input type="radio" id="{{ alt.alt_id }}" name="choice" value="{{ alt.alt_id }}"> {{ alt.description }}</input><br />
                                        {% endfor %}
                                    </fieldset>
                            {% endif %}<!-- End if question_type -->
                            <br />
                            <button class="btn btn-success" type="submit">Stem</button>
                            </form>
                        {% else %}
                            <p>Du har allerede avlagt stemme i denne saken.
                            {% if q.anonymous %}
                                <br /><br />
                                Din kvittering: <strong>{{ registered_voter.hide_user }}</strong>
                            {% endif %}
                            </p>
                        {% endif %}<!-- End if already voted -->
                    </div>
                    <div class="col-xs-12 col-sm-5 col-md-4">
                        <h3>Foreløpig status</h3>
                        {% if q %}
                            {% if q.only_show_winner %}
                                <p>Vinneren vil bli annonsert når alle stemmene er telt opp.</p>
                            {% else %}
                                {% with q.get_results as res %}
                                {% if q.question_type == 0 %}
                                    <strong>Ja</strong>: {{ res.JA }} stemme(r)<br />
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{ active_question.yes_percent }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ active_question.yes_percent }}%">
                                            {{ active_question.yes_percent }}%
                                        </div>
                                    </div>
                                    <strong>Nei</strong>: {{ res.NEI }} stemme(r)<br />
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="{{ active_question.no_percent }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ active_question.no_percent }}%">
                                            {{ active_question.no_percent }}%
                                        </div>
                                    </div>
                                    <strong>Blankt</strong>: {{ res.BLANKT }} stemme(r)<br />
                                    <div class="progress">
                                        <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="{{ active_question.blank_percent }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ active_question.blank_percent }}%">
                                            {{ active_question.blank_percent }}%
                                        </div>
                                    </div>
                                {% else %}
                                    {% for alt, votes in active_question.multiple_choice.items %}
                                        <strong>{{ alt }}</strong>: {{ votes.0 }} stemme(r)<br />
                                        <div class="progress">
                                            <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="{{ votes.1 }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ votes.1 }}%">
                                                 {{ votes.1 }}%
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% endif %}<!-- End if question_type -->
                                {% endwith %}
                            {% endif %}<!-- End if only_show_winner -->
                        {% else %}
                            <p>Ingen aktiv sak.</p>
                        {% endif %}<!-- End if question -->
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 col-sm-7 col-md-8">
                        <h3>Avsluttede saker</h3>
                        <p>Liste over avsluttede saker og deres sluttresultat.</p>
                        <p class="text-muted">
                        <ol reversed>
                            {% for question in meeting.get_locked_questions %}
                                <li>{{ question.description }} ({{ question.result }})</li>
                            {% endfor %}
                        </ol>
                        </p>
                    </div>
                    <div class="col-xs-12 col-sm-5 col-md-4">
                        <h3>Stemmer</h3>
                        <!-- insert list of registered votes here -->
                        {% if q %}<!-- If active queestion -->
                            {% if q.only_show_winner %}
                                <p>Vinneren vil bli annonsert når alle stemmene er telt opp</p>
                            {% else %}
                            <ul>
                            {% for vote in q.get_votes %}
                                <li>{% if q.anonymous %}
                                        {{ registered_voter.hide_user }}
                                    {% else %}
                                        {{ registered_voter }}
                                    {% endif %}
                                    {% if q.question_type == 0 %}<!-- If question type is boolean -->
                                        {% if vote.answer %}
                                            <span class="label label-success pull-right">Ja</span>
                                        {% else %}
                                            {% if vote.answer == False %}
                                                <span class="label label-danger pull-right">Nei</span>
                                            {% else %}
                                                <span class="label label-primary pull-right">Blankt</span>
                                            {% endif %}
                                        {% endif %}
                                    {% else %}<!-- If question type is multiple choice -->
                                        {% if vote.answer %}
                                            <span class="label label-primary pull-right">{{ vote.answer.description }}</span>
                                        {% else %}
                                            <span class="label label-warning pull-right">Blankt</span>
                                        {% endif %}
                                    {% endif %}
                                </li>
                            {% endfor %}
                            </ul>
                            {% endif %}
                        {% else %}
                        <p>Ingen aktiv sak.</p>
                        {% endif %}<!-- End if active question -->
                    </div>
                    {% endwith %}
                </div>
            </div>
            {% else %}
                <div class="col-md-12">
                    <p>Det er ingen aktiv generalforsamling.</p>
                </div>
            {% endif %}<!-- End if meeting -->
        </div>
    </div>
</section>
{% endblock %}

{% block js %}
    {{ block.super }}
    <!-- insert JS-stuff here -->
{% endblock %}
